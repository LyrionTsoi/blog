---
title: 基于有向图的毒株路径提取算法的研究
date: 2024-01-15 11:50:04
tags:
- 毕业论文
password: 2002
---

## Preliminaries

首先要明白的为什么要进行有向图的路径提取？

其实的是因为我们在大量读取样本数据的时候，读取数据会存在不同的病毒序列(其实一开始读取只是短读序列reads），只有通过的建立有向图的寻找路径方法，才能有效的区分出不同毒株的序列。每一个毒株对应着一种病毒的基因序列（路径）。

**如何进行路径提取是毕业设计主要解决的问题。**



### 如何建立AG图？

#### 首先是构建的k-mer节点(solid K-mer)

文中 base on Kernel Density Estimation using the Gaussian kernel。简单理解为选择一个阈值高于的阈值的数据分为一个solid(实体，我理解是AG图上的一个节点或者更准确是一个单元)核密度的阈值选择具体在补充材料上

![](https://124newblog-1309411887.cos.ap-nanjing.myqcloud.com/images/202402251438338.png)

Solid K-mer对应上图的一个Unitig(U1,U2,....)

核密度方法具体为下面步骤

1. 首先，将数据集中的序列转换为k-mer，即将每个序列切分为固定长度的短序列。
2. 对于每个k-mer，计算其在整个数据集中的出现次数，形成一个频率分布。
3. 使用核密度估计方法（如高斯核密度估计）来计算这些频率的核密度，得到一个核密度图。
4. 根据核密度图，可以选择一个阈值来区分不同的密度区域，进而将数据集中的序列分成不同的簇或类别。

### 构建AG图

通过k-mer的方法我们可以得到AG图的“节点”（solids or unitigs),然后我们其实还需要通过的边来连接的，原DBG图中其实是有边的，但是我们需要再此基础上进行一个优化操作。这个操作就是remove isolated unitigs &tips shorter than a given threshold（说的是去除一个孤立节点和较短的边）并且要remove filigree edges.

补充

边为什么会有的距离，边的距离可能代表下面几个关系（网上查询）

- 基因之间的距离：如果基因组被表示为一个图，边的长度可以表示基因之间的物理距离或者基因组的某种测量单位（如bp）。
- 基因之间的相似性：边的长度也可以表示基因之间的相似性分数，比如基于序列相似性、功能相似性等计算得出的分数。
- 关联程度：在一些网络分析中，边的长度可以表示两个节点之间的关联程度或权重，比如基于共表达、共通路、共蛋白互作等关联性

filigree edges是什么？

"filigree edges"通常指的是在一个图（graph）中连接到孤立节点（isolated node）的边。这些边连接到图中仅有一个连接点的节点，



## Translate DAGs into offset flow network

Background

**Target Node (`T`):** the term "target node" refers to nodes in the original DAG that have **no outgoing** edges.

**Sink Node (also `T`):**The sink node in a flow network is a special node that all flows in the network are directed towards. 

### Orginal DAG Nodes and Arcs

![图二. DAG图](https://124newblog-1309411887.cos.ap-nanjing.myqcloud.com/images/202402271039975.png)

![图三. OFN](https://124newblog-1309411887.cos.ap-nanjing.myqcloud.com/images/202402271039791.png)

In the original DAG, you have a set of nodes `V` and a set of directed edges `E` that connect these nodes. Each node can represent a state or a unitig, and each directed edge represents a possible transition from one node to another.

1. Replace each node in DAG.For each node `v` in the DAG, you create two new nodes: an "in" node `v_in` and an "out" node `v_out`. These nodes are connected by an arc `(v_out, v_in)`. This split allows the flow network to control the flow entering and leaving the original node `v`.（其实很简单就是将有向图节点一分为二)
1. **Translate the original edges**: For each original edge `(u, v)` in the DAG, you create two new edges in the OFN(因为原本只有一个节点现在分裂成两个节点之后，两个节点之间需要边来连接，于是乎就需要用两条相反方向的边进行连接 )
1. Add start (S) and target (T) nodes.加源点和汇点。
1. Add an artiﬁcial source (S ∗ ) and sink (T ∗ ) to manage the exogenous ﬂow.（这里的exogenous flow 问题我不是很懂）
1. 最后要给边上权值。（但是权值取值问题不太理解，我的理解是用原本node节点的权值 = $v_{out}$指向$v_{in}$的边，$v_{in}$指向$v_{out}$的边为无穷）

## question in resarch

1. **基于重叠图的从头开始组装方法的优缺点。**

   在文章 "De Novo Assembly of Viral Quasispecies Using Overlap Graphs" 中，Baaijens et al. 描述了一种新的计算工具，SAVAGE，它利用重叠图 (overlap graphs) 来从深度覆盖的患者样本数据中重建单个病毒株的单倍型。以下是对文中提及的重叠图使用的优点和缺点的详细总结：

   *优点：*

   1. **不依赖参考基因组**：SAVAGE能够重建病毒株的单倍型，而无需高质量的参考基因组，这在新疾病暴发时尤其重要，因为那时可能没有可用的参考基因组。

   2. **区分真实变异和测序错误**：通过重叠图的使用，SAVAGE能够识别共存的突变，从而将同一株系中的突变相互区分，并与测序错误区分开来。

   3. **处理多态位点**：病毒在单个读段内可能会有多个多态位点。重叠图能够处理这种情况并将突变归入不同的单倍型。

   4. **统计模型支持**：SAVAGE使用一种基于FM-index的数据结构或临时共识参考序列来构建重叠图，这在统计上被精心校准以确保重叠节点代表相同的单倍型序列。

   5. **迭代方案**：SAVAGE采用迭代方案，通过统计上校准良好的读段/重叠群体的枚举，有效地从重叠图中重建单倍型。

   6. **性能**：在模拟和实际深度覆盖数据的基准实验中，SAVAGE在重建单倍型方面的性能显著优于通用的从头开始组装程序以及目前唯一可用的专门针对病毒株系的从头开始组装器。

   *缺点：*

   1. **计算资源**：尽管SAVAGE比以前的重叠图基础的病毒株系组装算法更快、更节省空间，但生成重叠图还是需要使用复杂的索引技术，这可能要求更多的计算资源。

   2. **低频率株系的挑战**：尽管SAVAGE能够识别低频率的变异，但在频率低于1%的情况下重建单倍型仍然具有一定的挑战。

   3. **读段长度的依赖性**：SAVAGE的性能可能受到测序读段长度的影响。虽然它在较短的读段上仍然表现良好，但这可能会导致组装更加碎片化。

   4. **数据集分割**：在处理深度覆盖数据时，SAVAGE需要将数据集划分为小块进行处理，这可能会影响其能够恢复的株系频率的下限。

   5. **参考基因组质量**：在使用引导参考序列（bootstrap reference sequence）时，SAVAGE的性能会受到参考基因组质量的影响，这可能会降低目标基因组覆盖率。

   整体而言，重叠图在SAVAGE中的使用提供了一种强大的策略，用于在没有高质量参考基因组的情况下，从头开始组装病毒株系的单倍型。然而，这个方法仍需要优化以处理低频率株系和提高对测序读段长度的适应性。

2. **有向图与重叠图之间的区别在哪里？**

   有向图（De Bruijn Graph, DBG）和重叠图（Overlap Graph）是两种不同的数据结构，常用于基因组装。它们在处理测序数据，尤其是在组装病毒群体或者其他基因组时有不同的表现。以下是它们的主要区别：

   1. **基本概念**:
      - **有向图 (DBG)**: 使用固定长度的k-mer作为节点，若两个k-mer在测序数据中相邻，则在它们之间建立有向边。它不直接表达序列的重叠关系，而是通过k-mer的连接关系来推断。
      - **重叠图 (Overlap Graph)**: 每个节点代表一个测序读段或者其子串，边代表读段之间的重叠关系。如果两个读段有足够长的后缀和前缀完全匹配，则在它们之间建立一条边，边的权重通常是重叠的长度。

   2. **构建复杂性**:
      - **有向图 (DBG)**: 通常在构建时需要较少的内存，并且处理速度较快。因为它基于固定长度的k-mer，不需要存储大量的重叠信息。
      - **重叠图 (Overlap Graph)**: 在构建时可能需要更多的内存，因为它需要存储所有可能的重叠关系。构建过程中可能涉及到复杂的重叠检测算法以及需要一些复杂的索引方式，这可能导致更慢的处理速度。

   3. **准确性与分辨力**:
      - **有向图 (DBG)**: 对于高复杂性或重复序列丰富的基因组，由于使用k-mer的固定长度，可能导致某些重复区域无法准确解析。
      - **重叠图 (Overlap Graph)**: 由于直接反映了读段之间的重叠关系，可能在处理重复序列时提供更高的准确性和分辨力。

   4. **应用范围**:
      - **有向图 (DBG)**: 更适合于高通量的测序数据，尤其是当读段较短或者测序误差较高时。
      - **重叠图 (Overlap Graph)**: 更适用于长读段测序技术，因为长读段可以提供更多的重叠信息，有助于提高组装的准确性。

   5. **扩展性与灵活性**:
      - **有向图 (DBG)**: 受限于k-mer的长度，调整k的大小可以影响组装的结果，但不易于调整以适应不同的数据类型。
      - **重叠图 (Overlap Graph)**: 可以更灵活地处理不同长度的读段，更容易适应不同的基因组特征。

   在实践中，这两种图的选择取决于具体的应用场景、数据类型以及所需的准确性和效率。有时，研究人员甚至会结合使用这两种图，以期在准确性和效率之间找到最佳平衡。

   





**有向图和重叠图之间的相比较的区别在哪？**





基本思路

在这种情况下，配对信息的权重表示节点之间同时出现在reads中的次数。这个权重可以用来估计两个节点在同一条路径上的可能性。在动态规划（DP）算法中，我们可以使用这些权重来更新状态转移方程，以找到最可能的路径。

这里是一种可能的方法：

1. **定义状态**:
   - `dp[v]` 表示到达节点 `v` 的最优路径的概率。

2. **初始化**:
   - 对于起点节点 `1`，设置 `dp[1]` 为1。
   - 对于其他节点，初始化 `dp[v]` 为0。

3. **状态转移**:
   - 对于每个节点 `v`，找到所有可能到达 `v` 的节点 `u`（即 `v` 的父节点），然后根据配对信息中的权重更新 `dp[v]`。状态转移方程可以写为：
     ```
     dp[v] = max(dp[u] * weight(u, v)) 对所有 u -> v
     ```
     其中 `weight(u, v)` 是配对信息中节点 `u` 和 `v` 的权重。

4. **更新DP数组**:
   - 对于每个节点 `v`，根据其父节点的DP值和配对权重进行更新。例如：
     - 如果节点 `2` 和 `5` 的配对权重为1，则 `dp[5]` 可能来自 `dp[2] * weight(2, 5)`。

5. **考虑终点**:
   - 使用配对信息更新终点节点的DP值。例如：
     - `dp[5]` 可能来自 `dp[4] * weight(2, 5)`，因为节点 `2` 到 `5` 有配对信息。

6. **提取路径**:
   - 从终点节点开始，使用DP数组中记录的概率信息逆向追溯回起点。

这个DP算法使用了配对信息的权重来更新状态，并尝试找到权重最高的路径，即最可能代表真实毒株的路径。在实际应用中，可能需要对这个基础模型进行调整，比如考虑丰度信息、处理环路、或者使用更复杂的状态定义来更准确地反映路径的可能性。

